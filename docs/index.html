<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>THE 密室からの脱出 ～まやかしの専門学校～</title>
    <link rel="stylesheet" href="css/style.css">
  </head>
  <body>
    <div class="bg" aria-hidden="true"></div>

    <main class="stage">
      <div id="textbox" class="textbox" role="region" aria-label="ゲームのテキストボックス">
        <p id="text" class="text"></p>
      </div>

      <!-- Direction buttons for scene navigation -->
      <div id="directions" class="directions" aria-label="方向選択ボタン">
        <button id="dir-up" class="dir-btn dir-up" data-direction="up" aria-label="上">
          <img src="asset/images/arrow.webp" alt="">
        </button>
        <button id="dir-left" class="dir-btn dir-left" data-direction="left" aria-label="左">
          <img src="asset/images/arrow.webp" alt="">
        </button>
        <button id="dir-down" class="dir-btn dir-down" data-direction="down" aria-label="下">
          <img src="asset/images/arrow.webp" alt="">
        </button>
        <button id="dir-right" class="dir-btn dir-right" data-direction="right" aria-label="右">
          <img src="asset/images/arrow.webp" alt="">
        </button>
      </div>

      <!-- Search button to view full background image -->
      <button id="search-btn" class="search-btn" aria-label="背景を拡大表示">
        <img src="asset/images/search.webp" alt="">
      </button>

      <!-- Skip button for text mode -->
      <button id="skip-btn" class="skip-btn" aria-label="テキストをスキップ">スキップ</button>

      <!-- Curtain button for window-curtain scene -->
      <button id="curtain-btn" class="curtain-btn" aria-label="カーテンをめくる">めくる</button>

      <!-- Password button for display-zoomin scene -->
      <button id="password-btn" class="password-btn" aria-label="パスワードを入力">パスワードを入力</button>

      <!-- Final Password button for display-zoomin-on scene (2nd+ visit) -->
      <button id="finalPassword-btn" class="password-btn" aria-label="番号を入力">番号を入力</button>

      <!-- Message bubble button for scenes with first-visit text -->
      <button id="message-btn" class="message-btn" aria-label="セリフを表示">
        <img src="asset/images/message.webp" alt="">
      </button>
    </main>

    <!-- Message overlay modal -->
    <div id="message-modal" class="message-modal" style="display:none;">
      <div class="message-modal-content">
        <p id="message-text" class="message-text"></p>
      </div>
    </div>
    <!-- 4-Digit Final Password Modal -->
    <div id="finalPassword-modal" class="password-modal">
      <div class="password-modal-content">
        <h2>番号を入力</h2>
        <div class="password-input-container">
          <input type="text" maxlength="1" class="password-digit" id="finalPassword-digit-1" />
          <input type="text" maxlength="1" class="password-digit" id="finalPassword-digit-2" />
          <input type="text" maxlength="1" class="password-digit" id="finalPassword-digit-3" />
          <input type="text" maxlength="1" class="password-digit" id="finalPassword-digit-4" />
        </div>
        <p class="password-error" id="finalPassword-error"></p>
        <div class="password-buttons">
          <button id="finalPassword-submit" class="password-submit-btn">確認</button>
          <button id="finalPassword-cancel" class="password-cancel-btn">キャンセル</button>
        </div>
      </div>
    </div>

    <div id="password-modal" class="password-modal">
      <div class="password-modal-content">
        <h2>暗証番号を入力</h2>
        <div class="password-input-container">
          <input type="text" maxlength="1" class="password-digit" id="digit-1" />
          <input type="text" maxlength="1" class="password-digit" id="digit-2" />
          <input type="text" maxlength="1" class="password-digit" id="digit-3" />
          <input type="text" maxlength="1" class="password-digit" id="digit-4" />
          <input type="text" maxlength="1" class="password-digit" id="digit-5" />
          <input type="text" maxlength="1" class="password-digit" id="digit-6" />
        </div>
        <p class="password-error" id="password-error"></p>
        <div class="password-buttons">
          <button id="password-submit" class="password-submit-btn">確認</button>
          <button id="password-cancel" class="password-cancel-btn">キャンセル</button>
        </div>
      </div>
    </div>

    <!-- inline JSON fallback: opening the HTML file directly (file://) may block fetch().
         These script tags provide the same data as data/*.json for environments
         where fetch cannot read local files. -->
    
    <!-- Prologue chapter -->
    <script id="prologue-texts" type="application/json">
{
  "texts": [
    "KD専門学校に入学して、3年という月日が経ってしまった。",
    "私には誰にも言えない秘密がある…",
    "最近の日課は、教室に残って勉強しながら寝落ちをすることである。使用していない教室をこっそり使わせてもらっているのだ。",
    "今日もいつものごとく、勉強につかれてうとうとしていた。まさか、こんなことになるなんて…",

    { "cmd": "bg", "src": "asset/images/room-front.webp", "transition": true },

    { "cmd": "nextChapter", "chapter": "chapter1" }
  ]
}
    </script>

    <!-- Chapter 1 -->
    <script id="chapter1-texts" type="application/json">
{
  "texts": [
    "はあああああ……もう夕方かぁ、よく寝たな。",
    "やはり空き教室は最高だ。寝起きでも空気がうまい！\nしかし、こんなに勉強に適した環境があるのに、なぜ皆やらないんだろう？",
    "まあ、そんなことはどうでもいい！片づけをして、教室を出るとしよう。",

    { "cmd": "bg", "src": "asset/images/room-front.webp", "transition": true },

    "さて、片付けも終わったし、そろそろ帰るとするか。",
    "それにしても、外がずいぶん暗くなってきたな…今何時だろう？",

    "スマートフォンで時刻を確認しようとしたが…電源がつかない。",
    "充電切れか？まずいな、これじゃ時間がわからない。",

    "この空き教室には時計もないし、日も暮れかけている。",
    "今日はあのバラエティー番組の再放送だ。急いで帰らなければならない。",

    "よし、さっさと出よう！",

    { "cmd": "wait", "ms": 2000 },

    "…？",
    "ドアが…開かない？",

    "まさか、閉じ込められた…？",
    "こんな時間に空き教室を使っていたことがバレるわけにはいかない。",

    "それに、夜になる前にどうにかして脱出しなければ…",
    "落ち着け。きっと何か手掛かりがあるはずだ。",

    "教室中を調べて、脱出する方法を見つけよう！",

    { "cmd": "nextChapter", "chapter": "chapter2" }
  ]
}
    </script>

    <!-- Chapter 2 - Scene based navigation -->
    <script id="chapter2-texts" type="application/json">
{
  "scenes": {
    "room-front": {
      "bg": "asset/images/room-front.webp",
      "directions": {
        "up": {
          "default": "room-tv",
          "cleared": "room-tv-on"
        },
        "right": "sdgs",
        "down": {
          "default": "door-close",
          "cleared": "door-open"
        },
        "left": "window-curtain"
      }
    },
    "room-front-on": {
      "bg": "asset/images/room-front-on.webp",
      "directions": {
        "up": {
          "default": "room-tv",
          "cleared": "room-tv-on"
        },
        "right": "sdgs",
        "down": {
          "default": "door-close",
          "cleared": "door-open"
        },
        "left": "window-curtain"
      }
    },
    "room-tv": {
      "bg": "asset/images/room-tv.webp",
      "directions": {
        "up": {
          "default": "tv-zoomin",
          "cleared": "tv-zoomin-on"
        },
        "right": {
          "default": "display-zoomin",
          "cleared": "display-zoomin-on"
        },
        "down": {
          "default": "room-front",
          "cleared": "room-front-on"
        },
        "left": "pc-number"
      }
    },
    "room-tv-on": {
      "bg": "asset/images/room-tv-on.webp",
      "directions": {
        "up": {
          "default": "tv-zoomin",
          "cleared": "tv-zoomin-on"
        },
        "right": {
          "default": "display-zoomin",
          "cleared": "display-zoomin-on"
        },
        "down": {
          "default": "room-front",
          "cleared": "room-front-on"
        },
        "left": "pc-number"
      }
    },
    "pc-number": {
      "bg": "asset/images/pc-number.webp",
      "firstVisitText": "教卓のなかに何か紙が入っている。この番号は一体なんだ？",
      "directions": {
        "right": {
          "default": "room-tv",
          "cleared": "room-tv-on"
        }
      }
    },
    "display-zoomin": {
      "bg": "asset/images/display-zoomin.webp",
      "firstVisitText": "とりあえず、PCを起動させよう。しかし、パスワードが分からないな。なにか周りに手掛かりがあればいいのだが…",
      "directions": {
        "left": {
          "default": "room-tv",
          "cleared": "room-tv-on"
        }
      }
    },
    "display-zoomin-on": {
      "bg": "asset/images/display-zoomin-on.webp",
      "firstVisitText": [
        "やったぞ！パスワードが合っていたようだ。",
        "ここに4ケタの数字を入力するのか？またかよ！\n待てよ、画面の端になにかメモ書きされているな。",
        "・いまあなたのうしろにいるの\n・窓に落書きをしないで\n・ここはどこ？わたしはだれ？\n・環境を大切に(ラジオネーム：C68831さんより)",
        "なんだこれ。ふざけてるのか！？\nいや、ヒントだと考えるべきか…あぶないあぶない、かなり疲れているようだ…こんなところ、早く脱出しよう。"
      ],
      "text": [
        "たしかヒントが書いてあったはずだ。",
        "・いまあなたのうしろにいるの\n・窓に落書きをしないで\n・ここはどこ？わたしはだれ？\n・環境を大切に(ラジオネーム：C68831さんより)",
        "本当にこれがヒントになっているのか…？",
        "そういえば、ここは管理棟の3階だったはず。何か関係あるのか？"
      ],
      "alwaysShowText": true,
      "action": "finalPassword",
      "directions": {
        "left": {
          "default": "room-tv",
          "cleared": "room-tv-on"
        }
      }
    },
    "sdgs": {
      "bg": "asset/images/sdgs.webp",
      "firstVisitText": "何の変哲もないSDGsのポスターだ。わが校はこれに取り組んでいるらしい。社会貢献は良いことなので、とても誇らしく思う。",
      "directions": {
        "left": {
          "default": "room-front",
          "cleared": "room-front-on"
        }
      }
    },
    "tv-zoomin": {
      "bg": "asset/images/tv-zoomin.webp",
      "firstVisitText": "この大きなモニターには、何も映っていない。",
      "directions": {
        "down": {
          "default": "room-tv",
          "cleared": "room-tv-on"
        }
      }
    },
    "tv-zoomin-on": {
      "bg": "asset/images/tv-zoomin-on.webp",
      "directions": {
        "down": {
          "default": "room-tv",
          "cleared": "room-tv-on"
        }
      }
    },
    "window-curtain": {
      "bg": "asset/images/window-curtain.webp",
      "firstVisitText": "窓には厚いカーテンが引かれている。",
      "action": "curtain",
      "directions": {}
    },
    "window-hint": {
      "bg": "asset/images/window-hint.webp",
      "firstVisitText": "窓に数字が書いてある…これはなにを意味しているのだろう？",
      "directions": {
        "down": {
          "default": "room-front",
          "cleared": "room-front-on"
        }
      }
    },
    "door-close": {
      "bg": "asset/images/door-close.webp",
      "text": "ドアはしっかり閉ざされている。まだ脱出できない…",
      "directions": {
        "up": {
          "default": "room-front",
          "cleared": "room-front-on"
        }
      }
    },
    "door-open": {
      "bg": "asset/images/door-open.webp",
      "firstVisitText": [
        "なんと扉が開いた！ようやくここから脱出できる…",
        "いったい何だったんだ？もうこんなことはやめにしよう…",
        "俺は明日から真っ当に生きるんだ！"
      ],
      "directions": {
        "up": {
          "next": "escape",
          "text": "脱出成功"
        }
      }
    },
    "escape": {
      "bg": "asset/images/escape.webp",
      "directions": {}
    }
  },
  "startScene": "room-front"
}
    </script>

    <script src="js/novel.js" defer></script>
  </body>
</html>
